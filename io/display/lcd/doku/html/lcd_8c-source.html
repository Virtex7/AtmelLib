<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>HD44780 Library: lcd.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>lcd.c</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> *    Filename: lcd.c</span>
<a name="l00003"></a>00003 <span class="comment"> *     Version: 0.2.2 - last change: two-controller cursor-switching</span>
<a name="l00004"></a>00004 <span class="comment"> * Description: HD44780 Display Library for ATMEL AVR</span>
<a name="l00005"></a>00005 <span class="comment"> *     License: Public Domain</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> *      Author: Copyright (C) Max Gaukler &lt;development@maxgaukler.de&gt;</span>
<a name="l00008"></a>00008 <span class="comment"> *        Date: 2010</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * I, the copyright holder of this work, hereby release it into the public domain. This applies worldwide.</span>
<a name="l00011"></a>00011 <span class="comment"> * In case this is not legally possible:</span>
<a name="l00012"></a>00012 <span class="comment"> * I grant anyone the right to use this work for any purpose, without any conditions, unless such conditions are required by law.</span>
<a name="l00013"></a>00013 <span class="comment"> * </span>
<a name="l00014"></a>00014 <span class="comment"> * This program is provided "as is" with absolutely no warranty, neither explicit nor implicit, as far as this is possible by law.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> */</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include "lcd.h"</span><span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">/// global variable that stores the current position. \see lcd_set_position() \ingroup lcd_functions</span>
<a name="l00020"></a><a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855">00020</a> <span class="comment"></span>uint8_t <a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>=0;<span class="comment"></span>
<a name="l00021"></a>00021 <span class="comment">/// global variable that stores the active controller (or 255 for all controllers). \see lcd_set_controller() \ingroup lcd_functions</span>
<a name="l00022"></a><a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683">00022</a> <span class="comment"></span>uint8_t <a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683" title="global variable that stores the active controller (or 255 for all controllers).">lcd_controller</a>=0;<span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment">/// global variable that stores the last cursor mode \see lcd_set_cursor() \ingroup lcd_functions</span>
<a name="l00024"></a><a class="code" href="group__lcd__functions.html#gbf201c7a38b9d01b88cdae2abe2ea3b0">00024</a> <span class="comment"></span>uint8_t <a class="code" href="group__lcd__functions.html#gbf201c7a38b9d01b88cdae2abe2ea3b0" title="global variable that stores the last cursor mode">lcd_cursor_mode</a>=0;
<a name="l00025"></a>00025 <span class="comment"></span>
<a name="l00026"></a>00026 <span class="comment">/** \defgroup lowlevelio Low-level IO functions</span>
<a name="l00027"></a>00027 <span class="comment">* Edit these functions (and possibly lcd_write()) to implement your own way of interfacing the LCD.</span>
<a name="l00028"></a>00028 <span class="comment">* @{</span>
<a name="l00029"></a>00029 <span class="comment">*/</span><span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment">/** Set data outputs</span>
<a name="l00031"></a>00031 <span class="comment">* </span>
<a name="l00032"></a>00032 <span class="comment">* In 4bit mode, this sets D4-D7 to bits 0-3 of the input value. In 8bit mode (not yet implemented!), this sets D0-D7 to the input value.</span>
<a name="l00033"></a>00033 <span class="comment">*/</span>
<a name="l00034"></a><a class="code" href="group__lowlevelio.html#g63c111d5d564f440682022cdb282b3d4">00034</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__lowlevelio.html#g63c111d5d564f440682022cdb282b3d4" title="Set data outputs.">LCD_DATA_OUT</a>(uint8_t data) {
<a name="l00035"></a>00035         LCD_OUT=(LCD_OUT&amp;(~(0x0F&lt;&lt;LCD_D4_PIN))) | (((data)&amp;0x0F)&lt;&lt;LCD_D4_PIN);
<a name="l00036"></a>00036         <a class="code" href="group__lowlevelio.html#g9296a4318c8dc4baf83afd81fd357feb" title="Update output port from buffer.">LCD_OUT_UPDATE</a>();
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 <span class="comment"></span>
<a name="l00039"></a>00039 <span class="comment">/** Set the RS output pin</span>
<a name="l00040"></a>00040 <span class="comment"></span>
<a name="l00041"></a>00041 <span class="comment">RS</span>
<a name="l00042"></a>00042 <span class="comment">*/</span>
<a name="l00043"></a><a class="code" href="group__lowlevelio.html#g1d2230b21228a75f1271dc07e04e8be4">00043</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__lowlevelio.html#g1d2230b21228a75f1271dc07e04e8be4" title="Set the RS output pin.">LCD_RS</a>(uint8_t rs) {
<a name="l00044"></a>00044         <span class="keywordflow">if</span> (rs) {
<a name="l00045"></a>00045                 LCD_OUT|=(1&lt;&lt;LCD_RS_PIN);
<a name="l00046"></a>00046         } <span class="keywordflow">else</span> {
<a name="l00047"></a>00047                 LCD_OUT&amp;=~(1&lt;&lt;LCD_RS_PIN);
<a name="l00048"></a>00048         }
<a name="l00049"></a>00049         <a class="code" href="group__lowlevelio.html#g9296a4318c8dc4baf83afd81fd357feb" title="Update output port from buffer.">LCD_OUT_UPDATE</a>();
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 <span class="comment"></span>
<a name="l00052"></a>00052 <span class="comment">/** Set the EN output pin</span>
<a name="l00053"></a>00053 <span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment"> "EN" (Enable) is the clock pin of the HD44780</span>
<a name="l00055"></a>00055 <span class="comment"> */</span>
<a name="l00056"></a><a class="code" href="group__lowlevelio.html#g6e2fe0dcc61696fe48f7ab8b58ba037e">00056</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__lowlevelio.html#g6e2fe0dcc61696fe48f7ab8b58ba037e" title="Set the EN output pin.">LCD_EN</a>(uint8_t en) {
<a name="l00057"></a>00057 <span class="comment">//      lcd_controller=1;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#ifdef LCD_TWO_CONTROLLERS</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (((<a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683" title="global variable that stores the active controller (or 255 for all controllers).">lcd_controller</a>==0) || (<a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683" title="global variable that stores the active controller (or 255 for all controllers).">lcd_controller</a>==255)) &amp;&amp; en) {
<a name="l00060"></a>00060                 LCD_OUT|=(1&lt;&lt;LCD_EN_PIN);
<a name="l00061"></a>00061         } <span class="keywordflow">else</span> {
<a name="l00062"></a>00062                 LCD_OUT&amp;=~(1&lt;&lt;LCD_EN_PIN);
<a name="l00063"></a>00063         }
<a name="l00064"></a>00064 <span class="preprocessor">#else</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (en) {
<a name="l00066"></a>00066                 LCD_OUT|=(1&lt;&lt;LCD_EN_PIN);
<a name="l00067"></a>00067         } <span class="keywordflow">else</span> {
<a name="l00068"></a>00068                 LCD_OUT&amp;=~(1&lt;&lt;LCD_EN_PIN);
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070 <span class="preprocessor">#endif</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>        
<a name="l00072"></a>00072 <span class="preprocessor">#ifdef LCD_TWO_CONTROLLERS</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (((<a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683" title="global variable that stores the active controller (or 255 for all controllers).">lcd_controller</a>==1) || (<a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683" title="global variable that stores the active controller (or 255 for all controllers).">lcd_controller</a>==255)) &amp;&amp; en) {
<a name="l00074"></a>00074                 LCD_OUT|=(1&lt;&lt;LCD_EN2_PIN);
<a name="l00075"></a>00075         } <span class="keywordflow">else</span> {
<a name="l00076"></a>00076                 LCD_OUT&amp;=~(1&lt;&lt;LCD_EN2_PIN);
<a name="l00077"></a>00077         }
<a name="l00078"></a>00078 <span class="preprocessor">#endif</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>        <a class="code" href="group__lowlevelio.html#g9296a4318c8dc4baf83afd81fd357feb" title="Update output port from buffer.">LCD_OUT_UPDATE</a>();
<a name="l00080"></a>00080 }
<a name="l00081"></a>00081 <span class="comment"></span>
<a name="l00082"></a>00082 <span class="comment">/** Update output port from buffer</span>
<a name="l00083"></a>00083 <span class="comment"></span>
<a name="l00084"></a>00084 <span class="comment">This does nothing for direct output. For shift registers it sends the (modified) output buffer to the shift register.</span>
<a name="l00085"></a>00085 <span class="comment">You can control inlining of this function by defining LCD_OUT_UPDATE_NEVER_INLINE (less size but less performance) or LCD_OUT_UPDATE_ALWAYS_INLINE (more size and more performance). By default it is inlined for all cases except LCD_MODE_SHIFT_4BIT and LCD_MODE_SHIFT_8BIT.</span>
<a name="l00086"></a>00086 <span class="comment"> */</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">// inline LCD_OUT_UPDATE for all trivial cases (direct output)</span>
<a name="l00089"></a>00089 <span class="preprocessor">#if !defined(DOXYGEN) &amp;&amp; ( (!defined LCD_MODE_SHIFT_4BIT &amp;&amp; !defined LCD_MODE_SHIFT_8BIT &amp;&amp; !defined LCD_OUT_UPDATE_NEVER_INLINE) || defined LCD_OUT_UPDATE_ALWAYS_INLINE )</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span><span class="keyword">inline</span> <span class="comment">/* inline the following function: */</span>
<a name="l00091"></a>00091 <span class="preprocessor">#endif</span>
<a name="l00092"></a><a class="code" href="group__lowlevelio.html#g9296a4318c8dc4baf83afd81fd357feb">00092</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="group__lowlevelio.html#g9296a4318c8dc4baf83afd81fd357feb" title="Update output port from buffer.">LCD_OUT_UPDATE</a>(<span class="keywordtype">void</span>) {
<a name="l00093"></a>00093 <span class="preprocessor">#if defined(LCD_MODE_SHIFT_4BIT)</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>        <span class="comment">// 4bit output with shift register</span>
<a name="l00095"></a>00095         uint8_t i;
<a name="l00096"></a>00096         <span class="keywordflow">for</span> (i=0;i&lt;8;i++) {
<a name="l00097"></a>00097                 <span class="keywordflow">if</span> (LCD_OUT&amp;(1&lt;&lt;(7-i))) {
<a name="l00098"></a>00098                         LCD_SHIFT_PORT|=(1&lt;&lt;LCD_SHIFT_DATA_PIN);
<a name="l00099"></a>00099                 } <span class="keywordflow">else</span> {
<a name="l00100"></a>00100                         LCD_SHIFT_PORT&amp;=~(1&lt;&lt;LCD_SHIFT_DATA_PIN);
<a name="l00101"></a>00101                 }
<a name="l00102"></a>00102                 _delay_us(1);
<a name="l00103"></a>00103                 LCD_SHIFT_PORT&amp;=~(1&lt;&lt;LCD_SHIFT_CLOCK_PIN);
<a name="l00104"></a>00104                 _delay_us(1);
<a name="l00105"></a>00105                 LCD_SHIFT_PORT|=1&lt;&lt;LCD_SHIFT_CLOCK_PIN;
<a name="l00106"></a>00106                 _delay_us(1);
<a name="l00107"></a>00107         }
<a name="l00108"></a>00108         LCD_SHIFT_PORT&amp;=~(1&lt;&lt;LCD_SHIFT_LATCH_PIN);
<a name="l00109"></a>00109         _delay_us(1);
<a name="l00110"></a>00110         LCD_SHIFT_PORT|=1&lt;&lt;LCD_SHIFT_LATCH_PIN;
<a name="l00111"></a>00111         _delay_us(1);
<a name="l00112"></a>00112 <span class="preprocessor">#elif defined(LCD_MODE_SHIFT_8BIT)</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span>        <span class="comment">// 8bit output with shift registers</span>
<a name="l00114"></a>00114 <span class="preprocessor">#error SHIFT_8BIT NOT YET IMPLEMENTED</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>        <span class="comment">// do nothing for diect output</span>
<a name="l00117"></a>00117 <span class="preprocessor">#endif</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>}
<a name="l00119"></a>00119 <span class="comment"></span>
<a name="l00120"></a>00120 <span class="comment">/*@}*/</span>
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="comment"></span>
<a name="l00123"></a>00123 <span class="comment">/** \defgroup lcd_functions Library Functions</span>
<a name="l00124"></a>00124 <span class="comment"></span>
<a name="l00125"></a>00125 <span class="comment">These functions are used for accessing the display.</span>
<a name="l00126"></a>00126 <span class="comment">@{</span>
<a name="l00127"></a>00127 <span class="comment">*/</span>
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="comment"></span>
<a name="l00131"></a>00131 <span class="comment">/// Send a raw command and wait for the execution time (3ms for home and clear, 100µs for all other commands)</span>
<a name="l00132"></a><a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe">00132</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(uint8_t data) {
<a name="l00133"></a>00133         <a class="code" href="group__lcd__functions.html#g932614e4a3dde92103df18b6868da624" title="Write data or commands to the LCD.">lcd_write</a>(data,0);
<a name="l00134"></a>00134         <span class="comment">// execution time 37us</span>
<a name="l00135"></a>00135         _delay_us(100);
<a name="l00136"></a>00136         <span class="keywordflow">if</span> ((data==<a class="code" href="group__raw__commands.html#ge0e309ccad89222eb3457f2da9f2bb8d" title="Home: go to position 0.">LCD_HOME</a>) || (data==<a class="code" href="group__raw__commands.html#g6aa8aa2057294b7d06088e834299b369" title="Clear: clear display and go to position 0.">LCD_CLEAR</a>)) {
<a name="l00137"></a>00137                 <span class="comment">// execution time 1.52ms</span>
<a name="l00138"></a>00138                 _delay_ms(3);
<a name="l00139"></a>00139         }
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 <span class="comment"></span>
<a name="l00142"></a>00142 <span class="comment">/// Send data and wait 50µs</span>
<a name="l00143"></a><a class="code" href="group__lcd__functions.html#gd0729d2cba627825a089ca1fff12ba29">00143</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#gd0729d2cba627825a089ca1fff12ba29" title="Send data and wait 50µs.">lcd_data</a>(uint8_t data) {
<a name="l00144"></a>00144         <a class="code" href="group__lcd__functions.html#g932614e4a3dde92103df18b6868da624" title="Write data or commands to the LCD.">lcd_write</a>(data,1);
<a name="l00145"></a>00145         <span class="comment">// execution time 37+4 us</span>
<a name="l00146"></a>00146         _delay_us(100);
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 <span class="comment"></span>
<a name="l00149"></a>00149 <span class="comment">/** Write data or commands to the LCD</span>
<a name="l00150"></a>00150 <span class="comment"></span>
<a name="l00151"></a>00151 <span class="comment">Edit this function to add your own way of 8 interfacing the LCD in 8-bit-mode (e.g. by shift register).</span>
<a name="l00152"></a>00152 <span class="comment">In 4-bit-mode this calls lcd_nibble() to send the half-bytes. */</span>
<a name="l00153"></a><a class="code" href="group__lcd__functions.html#g932614e4a3dde92103df18b6868da624">00153</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g932614e4a3dde92103df18b6868da624" title="Write data or commands to the LCD.">lcd_write</a>(uint8_t data, uint8_t rs) {      
<a name="l00154"></a>00154         <span class="comment">// RS</span>
<a name="l00155"></a>00155         <a class="code" href="group__lowlevelio.html#g1d2230b21228a75f1271dc07e04e8be4" title="Set the RS output pin.">LCD_RS</a>(rs);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157         <span class="comment">// address setup time 60ns</span>
<a name="l00158"></a>00158         _delay_us(0.1);
<a name="l00159"></a>00159         <a class="code" href="group__lcd__functions.html#ga5ed1c9a2a2fde3f98b02102c889dab9" title="Write a half-byte in 4-bit-mode to the LCD.">lcd_nibble</a>(data&gt;&gt;4);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         <a class="code" href="group__lcd__functions.html#ga5ed1c9a2a2fde3f98b02102c889dab9" title="Write a half-byte in 4-bit-mode to the LCD.">lcd_nibble</a>(data&amp;0x0F);
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 <span class="comment"></span>
<a name="l00164"></a>00164 <span class="comment">/**  Write a half-byte in 4-bit-mode to the LCD */</span>
<a name="l00165"></a><a class="code" href="group__lcd__functions.html#ga5ed1c9a2a2fde3f98b02102c889dab9">00165</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#ga5ed1c9a2a2fde3f98b02102c889dab9" title="Write a half-byte in 4-bit-mode to the LCD.">lcd_nibble</a>(uint8_t data) {
<a name="l00166"></a>00166         <span class="comment">// Send a nibble in 4bit mode</span>
<a name="l00167"></a>00167         <a class="code" href="group__lowlevelio.html#g63c111d5d564f440682022cdb282b3d4" title="Set data outputs.">LCD_DATA_OUT</a>(data);
<a name="l00168"></a>00168         _delay_us(10); <span class="comment">// data setup time 80ns, enable pulse width 230ns</span>
<a name="l00169"></a>00169         <a class="code" href="group__lowlevelio.html#g6e2fe0dcc61696fe48f7ab8b58ba037e" title="Set the EN output pin.">LCD_EN</a>(1);
<a name="l00170"></a>00170         _delay_us(10);
<a name="l00171"></a>00171         <a class="code" href="group__lowlevelio.html#g6e2fe0dcc61696fe48f7ab8b58ba037e" title="Set the EN output pin.">LCD_EN</a>(0);
<a name="l00172"></a>00172         _delay_us(10);
<a name="l00173"></a>00173         <span class="comment">// data hold time 10ns</span>
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="comment"></span>
<a name="l00178"></a>00178 <span class="comment">/** Initialise the LCD</span>
<a name="l00179"></a>00179 <span class="comment"></span>
<a name="l00180"></a>00180 <span class="comment">Call this function before using the LCD and 100ms after the supply voltage has become stable. */</span>
<a name="l00181"></a><a class="code" href="group__lcd__functions.html#g6842775ba83d166f02b8fef8bb63b1e6">00181</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g6842775ba83d166f02b8fef8bb63b1e6" title="Initialise the LCD.">lcd_init</a>(<span class="keywordtype">void</span>) {
<a name="l00182"></a>00182         <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(LCD_ALL_CONTROLLERS);
<a name="l00183"></a>00183         <a class="code" href="group__lowlevelio.html#g6e2fe0dcc61696fe48f7ab8b58ba037e" title="Set the EN output pin.">LCD_EN</a>(0);
<a name="l00184"></a>00184         <a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>=0;
<a name="l00185"></a>00185         <a class="code" href="group__lowlevelio.html#g1d2230b21228a75f1271dc07e04e8be4" title="Set the RS output pin.">LCD_RS</a>(0);
<a name="l00186"></a>00186 <span class="preprocessor">#if defined(LCD_MODE_SHIFT_4BIT) || defined(LCD_MODE_SHIFT_8BIT)</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span>        LCD_SHIFT_DDR|=(1&lt;&lt;LCD_SHIFT_DATA_PIN)|(1&lt;&lt;LCD_SHIFT_LATCH_PIN)|(1&lt;&lt;LCD_SHIFT_CLOCK_PIN);
<a name="l00188"></a>00188         LCD_SHIFT_PORT|=(1&lt;&lt;LCD_SHIFT_LATCH_PIN) | (1&lt;&lt;LCD_SHIFT_CLOCK_PIN);
<a name="l00189"></a>00189         <span class="comment">// all unused shift pins are automatically set to 0 because this is the buffer's start value</span>
<a name="l00190"></a>00190 <span class="preprocessor">#else</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>        LCD_DDR|=(1&lt;&lt;LCD_D4_PIN)|(1&lt;&lt;(LCD_D4_PIN+1))|(1&lt;&lt;(LCD_D4_PIN+2))|(1&lt;&lt;(LCD_D4_PIN+3))|(1&lt;&lt;LCD_RS_PIN)|(1&lt;&lt;LCD_EN_PIN);
<a name="l00192"></a>00192         
<a name="l00193"></a>00193 <span class="preprocessor">#ifdef LCD_RW_PIN</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>        LCD_DDR|=(1&lt;&lt;LCD_RW_PIN);
<a name="l00195"></a>00195         LCD_PORT&amp;=~(1&lt;&lt;LCD_RW_PIN);
<a name="l00196"></a>00196 <span class="preprocessor">#endif </span><span class="comment">/* LCD_RW_PIN */</span>
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="preprocessor">#ifdef LCD_TWO_CONTROLLERS</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span>        LCD_DDR|=(1&lt;&lt;LCD_EN2_PIN);
<a name="l00200"></a>00200 <span class="preprocessor">#endif </span><span class="comment">/* LCD_TWO_CONTROLLERS */</span>
<a name="l00201"></a>00201         
<a name="l00202"></a>00202 <span class="preprocessor">#endif</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>        <span class="comment">// See HD44780U datasheet: "Initializing by instruction, 4bit mode"</span>
<a name="l00204"></a>00204         <span class="comment">// Set interface to 8bit three times</span>
<a name="l00205"></a>00205         uint8_t i;
<a name="l00206"></a>00206         <span class="keywordflow">for</span> (i=0;i&lt;3;i++) {
<a name="l00207"></a>00207                 <a class="code" href="group__lcd__functions.html#ga5ed1c9a2a2fde3f98b02102c889dab9" title="Write a half-byte in 4-bit-mode to the LCD.">lcd_nibble</a>((<a class="code" href="group__raw__commands.html#g50de1697f1da8ab075a6b4d7aeace64e" title="Function Set: Initialize the Controllers - used by lcd_init()">LCD_FUNCTION</a>|<a class="code" href="group__raw__commands.html#g91d15d8e3008f6cb141406a8b5d0d3c0" title="Option: DL=1: interface data length 8bit.">LCD_FUNCTION_8BIT</a>)&gt;&gt;4);
<a name="l00208"></a>00208                 _delay_ms(10);
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210         _delay_us(10);
<a name="l00211"></a>00211         
<a name="l00212"></a>00212         <span class="comment">// Switch to 4bit mode (display is still in 8bit mode during this command)</span>
<a name="l00213"></a>00213         <a class="code" href="group__lcd__functions.html#ga5ed1c9a2a2fde3f98b02102c889dab9" title="Write a half-byte in 4-bit-mode to the LCD.">lcd_nibble</a>((<a class="code" href="group__raw__commands.html#g50de1697f1da8ab075a6b4d7aeace64e" title="Function Set: Initialize the Controllers - used by lcd_init()">LCD_FUNCTION</a>|<a class="code" href="group__raw__commands.html#g88267db52f73473e317ac0da8294239f" title="Option: DL=0: interface data length 4bit.">LCD_FUNCTION_4BIT</a>)&gt;&gt;4);
<a name="l00214"></a>00214         
<a name="l00215"></a>00215 <span class="comment">//      // First command</span>
<a name="l00216"></a>00216 <span class="comment">//      lcd_nibble((LCD_FUNCTION|LCD_FUNCTION_4BIT)&gt;&gt;4);</span>
<a name="l00217"></a>00217 <span class="comment">//      lcd_nibble((LCD_FUNCTION|LCD_FUNCTION_4BIT|LCD_FUNCTION_2LINES|LCD_FUNCTION_5x10)&amp;0x0f);</span>
<a name="l00218"></a>00218         
<a name="l00219"></a>00219         <span class="comment">// Now the display is mostly initialised and the real configuration can be set</span>
<a name="l00220"></a>00220         uint8_t init_command=<a class="code" href="group__raw__commands.html#g50de1697f1da8ab075a6b4d7aeace64e" title="Function Set: Initialize the Controllers - used by lcd_init()">LCD_FUNCTION</a>|<a class="code" href="group__raw__commands.html#g88267db52f73473e317ac0da8294239f" title="Option: DL=0: interface data length 4bit.">LCD_FUNCTION_4BIT</a>;
<a name="l00221"></a>00221 <span class="preprocessor">#if defined(LCD_5x10_PIXEL_CHARS)</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>        init_command |= <a class="code" href="group__raw__commands.html#g528cbca19acdb596f0cf1b780e564152" title="Option: F=1: character font.">LCD_FUNCTION_5x10</a>;
<a name="l00223"></a>00223 <span class="preprocessor">#else</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>        init_command |= <a class="code" href="group__raw__commands.html#gfbd0c91019fe97848ef21dfe4e12c08a" title="Option: F=0: character font.">LCD_FUNCTION_5x8</a>;
<a name="l00225"></a>00225 <span class="preprocessor">#endif</span>
<a name="l00226"></a>00226 <span class="preprocessor"></span>        uint8_t lines_per_controller=LCD_LINES;
<a name="l00227"></a>00227 <span class="preprocessor">#if defined(LCD_HALF_LINES)</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span>        <span class="comment">// two "half" lines are one real line</span>
<a name="l00229"></a>00229         lines_per_controller/=2;
<a name="l00230"></a>00230 <span class="preprocessor">#endif</span>
<a name="l00231"></a>00231 <span class="preprocessor"></span><span class="preprocessor">#if defined LCD_TWO_CONTROLLERS</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>        <span class="comment">// each controller has half of all lines</span>
<a name="l00233"></a>00233         lines_per_controller/=2;
<a name="l00234"></a>00234 <span class="preprocessor">#endif</span><span class="comment"></span>
<a name="l00235"></a>00235 <span class="comment">        /// \todo automatisches Setzen von 2LINES austesten</span>
<a name="l00236"></a>00236 <span class="comment"></span>        if (lines_per_controller==2) {
<a name="l00237"></a>00237                 init_command|=<a class="code" href="group__raw__commands.html#g6c24806bed18d565917165caa3475463" title="Option: N=1: two display lines (per controller).">LCD_FUNCTION_2LINES</a>;
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239         <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#g3147f4736f3c4bc12c5ac628f0f580ae" title="Entry Mode: set cursor and display movement">LCD_ENTRYMODE</a>|<a class="code" href="group__raw__commands.html#gfc92f3baa39818d346ea3790ec62db0a" title="Option: I/D=1: auto-increment (left-to-right) of character position.">LCD_ENTRYMODE_INCREMENT</a>);
<a name="l00240"></a>00240         <a class="code" href="group__lcd__functions.html#gd235a86241458b1e7b8771688bfdaf9a" title="Clear the LCD (takes 3ms to execute) and go back to the start position For two-controller...">lcd_clear</a>(); <span class="comment">// clear and go to home position</span>
<a name="l00241"></a>00241         <a class="code" href="group__lcd__functions.html#g3aabf730aa4e0393bb5c959583c00a8e" title="Go to the start position (takes 3ms to execute) This also resets some shift-options...">lcd_home</a>(); <span class="comment">// reset any shift-options</span>
<a name="l00242"></a>00242         <a class="code" href="group__lcd__functions.html#g9a4f2e437d82747664790aed0f1e4b69" title="Set the cursor mode, switches the LCD on or off.">lcd_set_cursor</a>(0); <span class="comment">// LCD_ON_CURSOR_OFF</span>
<a name="l00243"></a>00243         <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(0);
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 <span class="comment"></span>
<a name="l00246"></a>00246 <span class="comment">/** Go to the start position (takes 3ms to execute)</span>
<a name="l00247"></a>00247 <span class="comment">* This also resets some shift-options that can be set by special LCD commands.</span>
<a name="l00248"></a>00248 <span class="comment">*/</span>
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="group__lcd__functions.html#g3aabf730aa4e0393bb5c959583c00a8e">00250</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g3aabf730aa4e0393bb5c959583c00a8e" title="Go to the start position (takes 3ms to execute) This also resets some shift-options...">lcd_home</a>(<span class="keywordtype">void</span>) {
<a name="l00251"></a>00251 <span class="preprocessor">#ifdef LCD_TWO_CONTROLLERS</span>
<a name="l00252"></a>00252 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(1);
<a name="l00253"></a>00253         <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#ge0e309ccad89222eb3457f2da9f2bb8d" title="Home: go to position 0.">LCD_HOME</a>); <span class="comment">// home also resets some shift options</span>
<a name="l00254"></a>00254         <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(0);
<a name="l00255"></a>00255 <span class="preprocessor">#endif</span>
<a name="l00256"></a>00256 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>=0;
<a name="l00257"></a>00257         <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#ge0e309ccad89222eb3457f2da9f2bb8d" title="Home: go to position 0.">LCD_HOME</a>);
<a name="l00258"></a>00258 <span class="preprocessor">#ifdef LCD_TWO_CONTROLLERS</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span>        <span class="comment">// call lcd_set_cursor() to switch off cursor on inactive controller for two-controller displays</span>
<a name="l00260"></a>00260         <a class="code" href="group__lcd__functions.html#g9a4f2e437d82747664790aed0f1e4b69" title="Set the cursor mode, switches the LCD on or off.">lcd_set_cursor</a>(<a class="code" href="group__lcd__functions.html#gbf201c7a38b9d01b88cdae2abe2ea3b0" title="global variable that stores the last cursor mode">lcd_cursor_mode</a>);
<a name="l00261"></a>00261 <span class="preprocessor">#endif</span>
<a name="l00262"></a>00262 <span class="preprocessor"></span>}
<a name="l00263"></a>00263 <span class="comment"></span>
<a name="l00264"></a>00264 <span class="comment">/** (internal function) Select the controller</span>
<a name="l00265"></a>00265 <span class="comment"></span>
<a name="l00266"></a>00266 <span class="comment">@param num The controller number (counted from zero) or LCD_ALL_CONTROLLERS. */</span>
<a name="l00267"></a><a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6">00267</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(uint8_t num) {
<a name="l00268"></a>00268 <span class="preprocessor">#ifdef LCD_TWO_CONTROLLERS</span>
<a name="l00269"></a>00269 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683" title="global variable that stores the active controller (or 255 for all controllers).">lcd_controller</a>=num;
<a name="l00270"></a>00270 <span class="preprocessor">#endif</span>
<a name="l00271"></a>00271 <span class="preprocessor"></span><span class="comment">//      lcd_controller=LCD_ALL_CONTROLLERS;</span>
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 <span class="comment"></span>
<a name="l00274"></a>00274 <span class="comment">/// Clear the LCD (takes 3ms to execute) and go back to the start position</span>
<a name="l00275"></a>00275 <span class="comment">/// For two-controller displays: switch back to the first controller after this</span>
<a name="l00276"></a><a class="code" href="group__lcd__functions.html#gd235a86241458b1e7b8771688bfdaf9a">00276</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#gd235a86241458b1e7b8771688bfdaf9a" title="Clear the LCD (takes 3ms to execute) and go back to the start position For two-controller...">lcd_clear</a>(<span class="keywordtype">void</span>) {
<a name="l00277"></a>00277         <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(LCD_ALL_CONTROLLERS);
<a name="l00278"></a>00278         <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#g6aa8aa2057294b7d06088e834299b369" title="Clear: clear display and go to position 0.">LCD_CLEAR</a>);
<a name="l00279"></a>00279         <a class="code" href="group__lcd__functions.html#g2f118878f15d5d64fade1bbc193be2fc" title="Go to the specified position.">lcd_set_position</a>(0);
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 <span class="comment"></span>
<a name="l00282"></a>00282 <span class="comment">/// Go to the start of the specified line</span>
<a name="l00283"></a><a class="code" href="group__lcd__functions.html#g25866d401362c56e699caec5336252dc">00283</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g25866d401362c56e699caec5336252dc" title="Go to the start of the specified line.">lcd_set_line</a>(uint8_t x) {
<a name="l00284"></a>00284         <a class="code" href="group__lcd__functions.html#g2f118878f15d5d64fade1bbc193be2fc" title="Go to the specified position.">lcd_set_position</a>(x*LCD_COLS);
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 <span class="comment"></span>
<a name="l00287"></a>00287 <span class="comment">/** Go to the specified position</span>
<a name="l00288"></a>00288 <span class="comment"></span>
<a name="l00289"></a>00289 <span class="comment">The position is stored in the global variable lcd_position. The command LCD_SET_DDRAM_ADDR then sets the position in the LCD controller. This also affects the cursor.</span>
<a name="l00290"></a>00290 <span class="comment">@param position The character number (Example: for a 4x20 character display the third line starts at 40) </span>
<a name="l00291"></a>00291 <span class="comment">*/</span>
<a name="l00292"></a><a class="code" href="group__lcd__functions.html#g2f118878f15d5d64fade1bbc193be2fc">00292</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g2f118878f15d5d64fade1bbc193be2fc" title="Go to the specified position.">lcd_set_position</a>(uint8_t position) {
<a name="l00293"></a>00293         <span class="keywordflow">if</span> (position&gt;LCD_LINES*LCD_COLS) {
<a name="l00294"></a>00294                 position=position%(LCD_LINES*LCD_COLS);
<a name="l00295"></a>00295         }
<a name="l00296"></a>00296         <a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>=position;
<a name="l00297"></a>00297         uint8_t line=<a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>/LCD_COLS;
<a name="l00298"></a>00298 <span class="preprocessor">#ifdef LCD_HALF_LINES</span>
<a name="l00299"></a>00299 <span class="preprocessor"></span>        line=line/2;
<a name="l00300"></a>00300 <span class="preprocessor">#endif</span>
<a name="l00301"></a>00301 <span class="preprocessor"></span><span class="preprocessor">#ifdef LCD_TWO_CONTROLLERS</span>
<a name="l00302"></a>00302 <span class="preprocessor"></span>        uint8_t lcd_old_controller=<a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683" title="global variable that stores the active controller (or 255 for all controllers).">lcd_controller</a>;
<a name="l00303"></a>00303         <span class="comment">// two-controller displays must have at least two lines!</span>
<a name="l00304"></a>00304         <span class="keywordflow">if</span> (line&lt;LCD_LINES/2) {
<a name="l00305"></a>00305                 <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(0);
<a name="l00306"></a>00306         } <span class="keywordflow">else</span> {
<a name="l00307"></a>00307                 <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(1);
<a name="l00308"></a>00308         }
<a name="l00309"></a>00309         <span class="keywordflow">if</span> (<a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683" title="global variable that stores the active controller (or 255 for all controllers).">lcd_controller</a> != lcd_old_controller) {
<a name="l00310"></a>00310                 <span class="comment">// call lcd_set_cursor() to switch off cursor on inactive controller for two-controller displays</span>
<a name="l00311"></a>00311                 <a class="code" href="group__lcd__functions.html#g9a4f2e437d82747664790aed0f1e4b69" title="Set the cursor mode, switches the LCD on or off.">lcd_set_cursor</a>(<a class="code" href="group__lcd__functions.html#gbf201c7a38b9d01b88cdae2abe2ea3b0" title="global variable that stores the last cursor mode">lcd_cursor_mode</a>);
<a name="l00312"></a>00312         }
<a name="l00313"></a>00313 <span class="preprocessor">#endif</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span><span class="preprocessor">#ifdef LCD_SPECIAL_LINE_LAYOUT</span>
<a name="l00315"></a>00315 <span class="preprocessor"></span>        uint8_t line_addr;
<a name="l00316"></a>00316         <span class="keywordflow">if</span> (line==0) {
<a name="l00317"></a>00317                 line_addr=LCD_LINE1_ADDR;
<a name="l00318"></a>00318         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (line==1) {
<a name="l00319"></a>00319                 line_addr=LCD_LINE2_ADDR;
<a name="l00320"></a>00320         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (line==2) {
<a name="l00321"></a>00321                 line_addr=LCD_LINE3_ADDR;
<a name="l00322"></a>00322         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (line==3) {
<a name="l00323"></a>00323                 line_addr=LCD_LINE4_ADDR;
<a name="l00324"></a>00324         }
<a name="l00325"></a>00325 <span class="preprocessor">#else</span>
<a name="l00326"></a>00326 <span class="preprocessor"></span>        uint8_t line_addr=(line%2)*0x40;
<a name="l00327"></a>00327 <span class="preprocessor">#endif</span>
<a name="l00328"></a>00328 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#ge5fd52eb2dc8c41214d4872644e8f0aa" title="Set Display Data RAM Address (LCD Position) - used by lcd_set_position(), lcd_set_line()...">LCD_SET_DDRAM_ADDR</a>|(line_addr+<a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>%LCD_COLS));
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 <span class="comment"></span>
<a name="l00331"></a>00331 <span class="comment">/// Cursor Mode: No cursor</span>
<a name="l00332"></a><a class="code" href="group__lcd__functions.html#g906a5046affd4573e8bb1d24451868bc">00332</a> <span class="comment"></span><span class="preprocessor">#define LCD_ON_CURSOR_OFF 0</span><span class="comment"></span>
<a name="l00333"></a>00333 <span class="comment">/// Cursor Mode: Cursor on (underline the current character)</span>
<a name="l00334"></a><a class="code" href="group__lcd__functions.html#gccb8a1ca6d8f6ad997e1df6dea481a4b">00334</a> <span class="comment"></span>#define LCD_ON_CURSOR_ON 1<span class="comment"></span>
<a name="l00335"></a>00335 <span class="comment">/// Cursor Mode: Blink the current character</span>
<a name="l00336"></a><a class="code" href="group__lcd__functions.html#gffee496035102184ae39927978e69934">00336</a> <span class="comment"></span>#define LCD_ON_CURSOR_BLINK 2<span class="comment"></span>
<a name="l00337"></a>00337 <span class="comment">/// Cursor Mode: Cursor and Blink (underline and blink the current character)</span>
<a name="l00338"></a><a class="code" href="group__lcd__functions.html#g2b4b9543a586076b8cd5b21c1726abb2">00338</a> <span class="comment"></span>#define LCD_ON_CURSOR_AND_BLINK 3<span class="comment"></span>
<a name="l00339"></a>00339 <span class="comment">/// Cursor Mode: Display completely off</span>
<a name="l00340"></a><a class="code" href="group__lcd__functions.html#g0024da29b32bafdae7aa8d344791d674">00340</a> <span class="comment"></span>#define LCD_OFF 4
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 <span class="comment"></span>
<a name="l00345"></a>00345 <span class="comment">/** Set the cursor mode, switches the LCD on or off</span>
<a name="l00346"></a>00346 <span class="comment"></span>
<a name="l00347"></a>00347 <span class="comment">@param mode LCD_CURSOR_OFF, LCD_CURSOR_ON, LCD_BLINK or LCD_CURSOR_AND_BLINK</span>
<a name="l00348"></a>00348 <span class="comment">For two-controller LCDs: The cursor is only enabled for the current controller and disabled for the other controller. As soon as the cursor reaches the second display, the cursor is disabled on the first display and enabled on the second: When a controller change is done by lcd_set_position(), it calls lcd_set_cursor() again with the current mode, which is stored in the global variable lcd_cursor_mode. lcd_set_position is called automatically through lcd_linewrap() by lcd_putchar(), lcd_print() and lcd_putstr().</span>
<a name="l00349"></a>00349 <span class="comment">\todo test the new version of this function, especially two-controller cursor handling</span>
<a name="l00350"></a>00350 <span class="comment">*/</span>
<a name="l00351"></a><a class="code" href="group__lcd__functions.html#g9a4f2e437d82747664790aed0f1e4b69">00351</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g9a4f2e437d82747664790aed0f1e4b69" title="Set the cursor mode, switches the LCD on or off.">lcd_set_cursor</a>(uint8_t mode) {
<a name="l00352"></a>00352         <a class="code" href="group__lcd__functions.html#gbf201c7a38b9d01b88cdae2abe2ea3b0" title="global variable that stores the last cursor mode">lcd_cursor_mode</a>=mode;
<a name="l00353"></a>00353 <span class="preprocessor">#ifdef LCD_TWO_CONTROLLERS</span>
<a name="l00354"></a>00354 <span class="preprocessor"></span>        uint8_t lcd_old_controller=<a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683" title="global variable that stores the active controller (or 255 for all controllers).">lcd_controller</a>;
<a name="l00355"></a>00355 <span class="preprocessor">#endif</span>
<a name="l00356"></a>00356 <span class="preprocessor"></span>        <span class="comment">// Modes "on, no cursor" and "off" are for both controllers</span>
<a name="l00357"></a>00357         <span class="keywordflow">if</span> (mode==<a class="code" href="group__lcd__functions.html#g906a5046affd4573e8bb1d24451868bc" title="Cursor Mode: No cursor.">LCD_ON_CURSOR_OFF</a>) {
<a name="l00358"></a>00358                 <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(LCD_ALL_CONTROLLERS);
<a name="l00359"></a>00359                 <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#gcab2b60f7dac0a43694b105a013c5039" title="Display On/Off Control - used by lcd_set_cursor()">LCD_CONTROL</a>|<a class="code" href="group__raw__commands.html#g2080ed465c6450427feebc6e380abdb3" title="Option: D=1: display on.">LCD_CONTROL_DISPLAY_ON</a>|<a class="code" href="group__raw__commands.html#g38f1e08dc5c09633d0bb2c07164d57b3" title="Option: C=0: no cursor.">LCD_CONTROL_CURSOR_OFF</a>);
<a name="l00360"></a>00360         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode==<a class="code" href="group__lcd__functions.html#g0024da29b32bafdae7aa8d344791d674" title="Cursor Mode: Display completely off.">LCD_OFF</a>) {
<a name="l00361"></a>00361                 <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(LCD_ALL_CONTROLLERS);
<a name="l00362"></a>00362                 <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#gcab2b60f7dac0a43694b105a013c5039" title="Display On/Off Control - used by lcd_set_cursor()">LCD_CONTROL</a>|<a class="code" href="group__raw__commands.html#g5cc3719093a308b139aad8d2dd544240" title="Option: D=0: display off (clear).">LCD_CONTROL_DISPLAY_OFF</a>);
<a name="l00363"></a>00363         } <span class="keywordflow">else</span> {
<a name="l00364"></a>00364                 <span class="comment">// Mode "cursor enabled" is only for the active controller</span>
<a name="l00365"></a>00365                 <span class="keywordflow">if</span> (mode==<a class="code" href="group__lcd__functions.html#gccb8a1ca6d8f6ad997e1df6dea481a4b" title="Cursor Mode: Cursor on (underline the current character).">LCD_ON_CURSOR_ON</a>) {
<a name="l00366"></a>00366                         <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#gcab2b60f7dac0a43694b105a013c5039" title="Display On/Off Control - used by lcd_set_cursor()">LCD_CONTROL</a>|<a class="code" href="group__raw__commands.html#g2080ed465c6450427feebc6e380abdb3" title="Option: D=1: display on.">LCD_CONTROL_DISPLAY_ON</a>|<a class="code" href="group__raw__commands.html#g833d1a705bac2ee9d61e4cf8223563ce" title="Option: C=1: display cursor.">LCD_CONTROL_CURSOR_ON</a>);
<a name="l00367"></a>00367                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode==<a class="code" href="group__lcd__functions.html#gffee496035102184ae39927978e69934" title="Cursor Mode: Blink the current character.">LCD_ON_CURSOR_BLINK</a>) {
<a name="l00368"></a>00368                         <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#gcab2b60f7dac0a43694b105a013c5039" title="Display On/Off Control - used by lcd_set_cursor()">LCD_CONTROL</a>|<a class="code" href="group__raw__commands.html#g2080ed465c6450427feebc6e380abdb3" title="Option: D=1: display on.">LCD_CONTROL_DISPLAY_ON</a>|<a class="code" href="group__raw__commands.html#g38f1e08dc5c09633d0bb2c07164d57b3" title="Option: C=0: no cursor.">LCD_CONTROL_CURSOR_OFF</a>|<a class="code" href="group__raw__commands.html#g5acada1d15638cb18c97e3accc64f097" title="Option: B=1: blink current character.">LCD_CONTROL_BLINK</a>);
<a name="l00369"></a>00369                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode==<a class="code" href="group__lcd__functions.html#g2b4b9543a586076b8cd5b21c1726abb2" title="Cursor Mode: Cursor and Blink (underline and blink the current character).">LCD_ON_CURSOR_AND_BLINK</a>) {
<a name="l00370"></a>00370                         <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#gcab2b60f7dac0a43694b105a013c5039" title="Display On/Off Control - used by lcd_set_cursor()">LCD_CONTROL</a>|<a class="code" href="group__raw__commands.html#g2080ed465c6450427feebc6e380abdb3" title="Option: D=1: display on.">LCD_CONTROL_DISPLAY_ON</a>|<a class="code" href="group__raw__commands.html#g833d1a705bac2ee9d61e4cf8223563ce" title="Option: C=1: display cursor.">LCD_CONTROL_CURSOR_ON</a>|<a class="code" href="group__raw__commands.html#g5acada1d15638cb18c97e3accc64f097" title="Option: B=1: blink current character.">LCD_CONTROL_BLINK</a>);
<a name="l00371"></a>00371                 }
<a name="l00372"></a>00372 <span class="preprocessor">#ifdef LCD_TWO_CONTROLLERS</span>
<a name="l00373"></a>00373 <span class="preprocessor"></span>                <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>((<a class="code" href="group__lcd__functions.html#g47953d9e2decd2990fc652bde6fe1683" title="global variable that stores the active controller (or 255 for all controllers).">lcd_controller</a>+1)%2); <span class="comment">// switch to inactive controller</span>
<a name="l00374"></a>00374                 <span class="comment">// disable the cursor for the inactive controller</span>
<a name="l00375"></a>00375                 <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#gcab2b60f7dac0a43694b105a013c5039" title="Display On/Off Control - used by lcd_set_cursor()">LCD_CONTROL</a>|<a class="code" href="group__raw__commands.html#g2080ed465c6450427feebc6e380abdb3" title="Option: D=1: display on.">LCD_CONTROL_DISPLAY_ON</a>|<a class="code" href="group__raw__commands.html#g38f1e08dc5c09633d0bb2c07164d57b3" title="Option: C=0: no cursor.">LCD_CONTROL_CURSOR_OFF</a>);
<a name="l00376"></a>00376 <span class="preprocessor">#endif</span>
<a name="l00377"></a>00377 <span class="preprocessor"></span>        }
<a name="l00378"></a>00378 <span class="preprocessor">#ifdef LCD_TWO_CONTROLLERS</span>
<a name="l00379"></a>00379 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g615cf8980680849dce3c379d30e30ec6" title="(internal function) Select the controller">lcd_set_controller</a>(lcd_old_controller);
<a name="l00380"></a>00380 <span class="preprocessor">#endif</span>
<a name="l00381"></a>00381 <span class="preprocessor"></span>}
<a name="l00382"></a>00382 <span class="comment"></span>
<a name="l00383"></a>00383 <span class="comment">/** (internal function) If the cursor has passed the end of a line, set the position to the beginning of the next line</span>
<a name="l00384"></a>00384 <span class="comment"></span>
<a name="l00385"></a>00385 <span class="comment">This internal function is used for automatic line wrapping. It is necessary because the memory addresses of a line are not always consecutive: A 2x8 character display has line 1 at address 0-7 and line 2 at address 40-47. */</span>
<a name="l00386"></a><a class="code" href="group__lcd__functions.html#g52872b8bc9e8fc6988edb1dad61a33a2">00386</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g52872b8bc9e8fc6988edb1dad61a33a2" title="(internal function) If the cursor has passed the end of a line, set the position...">lcd_linewrap</a>(<span class="keywordtype">void</span>) {
<a name="l00387"></a>00387         <span class="comment">// Overflow: go back to the start</span>
<a name="l00388"></a>00388         <span class="keywordflow">if</span> (<a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>&gt;=LCD_LINES*LCD_COLS) {
<a name="l00389"></a>00389                 <a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>=0;
<a name="l00390"></a>00390         }
<a name="l00391"></a>00391         <span class="comment">// start of new line reached, set position</span>
<a name="l00392"></a>00392         <span class="keywordflow">if</span> (<a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>%LCD_COLS==0) {
<a name="l00393"></a>00393                 <a class="code" href="group__lcd__functions.html#g2f118878f15d5d64fade1bbc193be2fc" title="Go to the specified position.">lcd_set_position</a>(<a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>);
<a name="l00394"></a>00394         }
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 <span class="comment"></span>
<a name="l00397"></a>00397 <span class="comment">/** Write a single char to the LCD at the current position</span>
<a name="l00398"></a>00398 <span class="comment"> *</span>
<a name="l00399"></a>00399 <span class="comment"> * This will print a single char and move to the next position (with automatic linewrapping). If the current character was the last character on the display, the cursor will remain at the end of the display.</span>
<a name="l00400"></a>00400 <span class="comment"> *</span>
<a name="l00401"></a>00401 <span class="comment"> * @param chr The character (even 0x00 is allowed and will be printed).</span>
<a name="l00402"></a>00402 <span class="comment"> */</span>
<a name="l00403"></a><a class="code" href="group__lcd__functions.html#gb55f2679b2a60dd5ff9795feddffb4ba">00403</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#gb55f2679b2a60dd5ff9795feddffb4ba" title="Write a single char to the LCD at the current position.">lcd_putchar</a>(<span class="keywordtype">char</span> chr) {
<a name="l00404"></a>00404 
<a name="l00405"></a>00405         <span class="comment">// Test case 1: When writing the last character of a LCD, the cursor should stay there and blink</span>
<a name="l00406"></a>00406         <span class="comment">// Test case 2: After the full first line of a display the cursor should be at the beginning of the second line of the display</span>
<a name="l00407"></a>00407         <a class="code" href="group__lcd__functions.html#g52872b8bc9e8fc6988edb1dad61a33a2" title="(internal function) If the cursor has passed the end of a line, set the position...">lcd_linewrap</a>();
<a name="l00408"></a>00408         <a class="code" href="group__lcd__functions.html#gd0729d2cba627825a089ca1fff12ba29" title="Send data and wait 50µs.">lcd_data</a>(chr);
<a name="l00409"></a>00409         <a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>++;
<a name="l00410"></a>00410         <span class="keywordflow">if</span> (<a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>==LCD_LINES*LCD_COLS) {
<a name="l00411"></a>00411                 <span class="comment">// Last char has been reached: Move cursor to last char and not to the beginning of the screen</span>
<a name="l00412"></a>00412                 <a class="code" href="group__lcd__functions.html#g2f118878f15d5d64fade1bbc193be2fc" title="Go to the specified position.">lcd_set_position</a>(LCD_LINES*LCD_COLS-1);
<a name="l00413"></a>00413                 <a class="code" href="group__lcd__functions.html#g1d540b50dad7f76e97d843dd6f14a855" title="global variable that stores the current position.">lcd_position</a>=LCD_LINES*LCD_COLS;
<a name="l00414"></a>00414                 <span class="comment">// lcd_linewrap() will be called before writing the next char</span>
<a name="l00415"></a>00415         }
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417 <span class="comment"></span>
<a name="l00418"></a>00418 <span class="comment">/** Write a string starting at the current position</span>
<a name="l00419"></a>00419 <span class="comment"> *</span>
<a name="l00420"></a>00420 <span class="comment"> * This will print a string with automatic linewrapping. If the string is longer than the display, it will be displayed in multiple parts without a delay inbetween.</span>
<a name="l00421"></a>00421 <span class="comment"> *</span>
<a name="l00422"></a>00422 <span class="comment"> * @param str The string to be displayed (zero-terminated array of char)</span>
<a name="l00423"></a>00423 <span class="comment"> */</span>
<a name="l00424"></a><a class="code" href="group__lcd__functions.html#g441efb2945fb74fafb7914d6bd2d8161">00424</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g441efb2945fb74fafb7914d6bd2d8161" title="Write a string starting at the current position.">lcd_putstr</a>(<span class="keywordtype">char</span> *str) {
<a name="l00425"></a>00425         <span class="keywordflow">while</span> (*str!=0) {
<a name="l00426"></a>00426                 <a class="code" href="group__lcd__functions.html#gb55f2679b2a60dd5ff9795feddffb4ba" title="Write a single char to the LCD at the current position.">lcd_putchar</a>(*str);
<a name="l00427"></a>00427                 str++;
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 <span class="comment"></span>
<a name="l00431"></a>00431 <span class="comment">/** Write a string from ROM starting at the current position</span>
<a name="l00432"></a>00432 <span class="comment"> * </span>
<a name="l00433"></a>00433 <span class="comment"> * This will print a string with automatic linewrapping. If the string is longer than the display, it will be displayed in multiple parts without a delay inbetween.</span>
<a name="l00434"></a>00434 <span class="comment"> * </span>
<a name="l00435"></a>00435 <span class="comment"> * @param str The string to be displayed (zero-terminated array of char in ROM)</span>
<a name="l00436"></a>00436 <span class="comment"> */</span>
<a name="l00437"></a><a class="code" href="group__lcd__functions.html#gd3226e2e167c11093fa3641e5f33f732">00437</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#gd3226e2e167c11093fa3641e5f33f732" title="Write a string from ROM starting at the current position.">lcd_putstr_P</a>(PGM_P str) {
<a name="l00438"></a>00438         <span class="keywordflow">while</span> (pgm_read_byte(str)!=0) {
<a name="l00439"></a>00439                 <a class="code" href="group__lcd__functions.html#gb55f2679b2a60dd5ff9795feddffb4ba" title="Write a single char to the LCD at the current position.">lcd_putchar</a>(pgm_read_byte(str));
<a name="l00440"></a>00440                 str++;
<a name="l00441"></a>00441         }
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 <span class="comment"></span>
<a name="l00444"></a>00444 <span class="comment">/** Write a string after clearing the display</span>
<a name="l00445"></a>00445 <span class="comment"> *</span>
<a name="l00446"></a>00446 <span class="comment"> * This clears the display, and then writes a string starting at the home position.</span>
<a name="l00447"></a>00447 <span class="comment"> * </span>
<a name="l00448"></a>00448 <span class="comment"> * @param str The string to be displayed (zero-terminated array of char)</span>
<a name="l00449"></a>00449 <span class="comment">*/</span>
<a name="l00450"></a><a class="code" href="group__lcd__functions.html#g8531c55ba576c0b39c0d72bd6617c91f">00450</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g8531c55ba576c0b39c0d72bd6617c91f" title="Write a string after clearing the display.">lcd_print</a>(<span class="keywordtype">char</span> *str) {
<a name="l00451"></a>00451         <a class="code" href="group__lcd__functions.html#gd235a86241458b1e7b8771688bfdaf9a" title="Clear the LCD (takes 3ms to execute) and go back to the start position For two-controller...">lcd_clear</a>();
<a name="l00452"></a>00452         <a class="code" href="group__lcd__functions.html#g441efb2945fb74fafb7914d6bd2d8161" title="Write a string starting at the current position.">lcd_putstr</a>(str);
<a name="l00453"></a>00453 }
<a name="l00454"></a>00454 <span class="comment"></span>
<a name="l00455"></a>00455 <span class="comment">/** Add a custom character </span>
<a name="l00456"></a>00456 <span class="comment">        </span>
<a name="l00457"></a>00457 <span class="comment">This writes a custom character into character generator RAM. For displays with 5x8 pixel characters (the default), eight characters consisting of eight lines each can be stored. The eigth line is the cursor position which should be kept empty. Displays with 5x10 pixel characters can only store four characters consisting of eleven lines where the eleventh line is the cursor position.</span>
<a name="l00458"></a>00458 <span class="comment"></span>
<a name="l00459"></a>00459 <span class="comment">@param number The number can be between 0 and 7 (or 0-3 for 5x10 char displays). The saved character can be accessed by this number: You can include your characters in a string like "hello\001".</span>
<a name="l00460"></a>00460 <span class="comment">Due to technical limitations in C the character number zero can currently not really be used - 0x00 is the string terminating character so it cannot be included into strings. It can only be printed using lcd_putchar(0).</span>
<a name="l00461"></a>00461 <span class="comment"></span>
<a name="l00462"></a>00462 <span class="comment">@param data The character is supplied as array of uint8_t. Each line is one byte, bit 4 is the leftmost pixel and bit 0 is the rightmost pixel. The top line is the first byte.</span>
<a name="l00463"></a>00463 <span class="comment"></span>
<a name="l00464"></a>00464 <span class="comment">Example for 5x8 pixel character: This displays a black outlined box (the eight line is the cursor position).</span>
<a name="l00465"></a>00465 <span class="comment">@code</span>
<a name="l00466"></a>00466 <span class="comment">uint8_t character_box[]= {</span>
<a name="l00467"></a>00467 <span class="comment">0b00011111,</span>
<a name="l00468"></a>00468 <span class="comment">0b00010001,</span>
<a name="l00469"></a>00469 <span class="comment">0b00010001,</span>
<a name="l00470"></a>00470 <span class="comment">0b00010001,</span>
<a name="l00471"></a>00471 <span class="comment">0b00010001,</span>
<a name="l00472"></a>00472 <span class="comment">0b00010001,</span>
<a name="l00473"></a>00473 <span class="comment">0b00011111,</span>
<a name="l00474"></a>00474 <span class="comment">0b00000000 }</span>
<a name="l00475"></a>00475 <span class="comment">lcd_customchar(1,character_box);</span>
<a name="l00476"></a>00476 <span class="comment">lcd_print("This is a box: \001");</span>
<a name="l00477"></a>00477 <span class="comment">@endcode</span>
<a name="l00478"></a>00478 <span class="comment"> */</span>
<a name="l00479"></a><a class="code" href="group__lcd__functions.html#g70ff998a1fbdc2f2c8857b5fd7407436">00479</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#g70ff998a1fbdc2f2c8857b5fd7407436" title="Add a custom character.">lcd_customchar</a>(uint8_t number, uint8_t *data) {
<a name="l00480"></a>00480 <span class="preprocessor">#if defined LCD_5x10_PIXEL_CHARS        </span>
<a name="l00481"></a>00481 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#gbb237a65fd1053415cb67ba994ae5d6c" title="Set Character Generator RAM Address">LCD_SET_CGRAM_ADDR</a>|number&lt;&lt;4);
<a name="l00482"></a>00482         uint8_t bytes=11;
<a name="l00483"></a>00483 <span class="preprocessor">#else</span>
<a name="l00484"></a>00484 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#gbb237a65fd1053415cb67ba994ae5d6c" title="Set Character Generator RAM Address">LCD_SET_CGRAM_ADDR</a>|number&lt;&lt;3);
<a name="l00485"></a>00485         uint8_t bytes=8;
<a name="l00486"></a>00486 <span class="preprocessor">#endif</span>
<a name="l00487"></a>00487 <span class="preprocessor"></span>        uint8_t i;
<a name="l00488"></a>00488         <span class="keywordflow">for</span> (i=0;i&lt;bytes;i++) {
<a name="l00489"></a>00489                 <a class="code" href="group__lcd__functions.html#gd0729d2cba627825a089ca1fff12ba29" title="Send data and wait 50µs.">lcd_data</a>(*data);
<a name="l00490"></a>00490                 data++;
<a name="l00491"></a>00491         }
<a name="l00492"></a>00492 <span class="preprocessor">#if defined LCD_5x10_PIXEL_CHARS        </span>
<a name="l00493"></a>00493 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (i=0;i&lt;5;i++) {
<a name="l00494"></a>00494                 <a class="code" href="group__lcd__functions.html#gd0729d2cba627825a089ca1fff12ba29" title="Send data and wait 50µs.">lcd_data</a>(0);
<a name="l00495"></a>00495         }
<a name="l00496"></a>00496         uint8_t bytes=11;
<a name="l00497"></a>00497 <span class="preprocessor">#endif</span>
<a name="l00498"></a>00498 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#ge5fd52eb2dc8c41214d4872644e8f0aa" title="Set Display Data RAM Address (LCD Position) - used by lcd_set_position(), lcd_set_line()...">LCD_SET_DDRAM_ADDR</a>|0);
<a name="l00499"></a>00499         <a class="code" href="group__lcd__functions.html#g3aabf730aa4e0393bb5c959583c00a8e" title="Go to the start position (takes 3ms to execute) This also resets some shift-options...">lcd_home</a>();
<a name="l00500"></a>00500 }<span class="comment"></span>
<a name="l00501"></a>00501 <span class="comment">/** Add a custom character from ROM</span>
<a name="l00502"></a>00502 <span class="comment">This is like lcd_customchar(), but the character is stored in flash ROM and does not consume RAM space.</span>
<a name="l00503"></a>00503 <span class="comment">\todo test this</span>
<a name="l00504"></a>00504 <span class="comment"></span>
<a name="l00505"></a>00505 <span class="comment">Example:</span>
<a name="l00506"></a>00506 <span class="comment">@code</span>
<a name="l00507"></a>00507 <span class="comment">// this needs to be global (out of any function, out of main):</span>
<a name="l00508"></a>00508 <span class="comment">const PROGMEM uint8_t character_box[]= {</span>
<a name="l00509"></a>00509 <span class="comment">0b00011111,</span>
<a name="l00510"></a>00510 <span class="comment">0b00010001,</span>
<a name="l00511"></a>00511 <span class="comment">0b00010001,</span>
<a name="l00512"></a>00512 <span class="comment">0b00010001,</span>
<a name="l00513"></a>00513 <span class="comment">0b00010001,</span>
<a name="l00514"></a>00514 <span class="comment">0b00010001,</span>
<a name="l00515"></a>00515 <span class="comment">0b00011111,</span>
<a name="l00516"></a>00516 <span class="comment">0b00000000 }</span>
<a name="l00517"></a>00517 <span class="comment"></span>
<a name="l00518"></a>00518 <span class="comment">// in the function:</span>
<a name="l00519"></a>00519 <span class="comment">lcd_customchar_P(1,character_box);</span>
<a name="l00520"></a>00520 <span class="comment">lcd_print("This is a box: \001");</span>
<a name="l00521"></a>00521 <span class="comment">@endcode</span>
<a name="l00522"></a>00522 <span class="comment">*/</span>
<a name="l00523"></a>00523 
<a name="l00524"></a><a class="code" href="group__lcd__functions.html#ga359b210285538e2fb99c2066586f3c8">00524</a> <span class="keywordtype">void</span> <a class="code" href="group__lcd__functions.html#ga359b210285538e2fb99c2066586f3c8" title="Add a custom character from ROM This is like lcd_customchar(), but the character...">lcd_customchar_P</a>(uint8_t number, PGM_P data) {
<a name="l00525"></a>00525 <span class="preprocessor">#warning lcd_customchar_P untested</span>
<a name="l00526"></a>00526 <span class="preprocessor"></span><span class="preprocessor">#if defined LCD_5x10_PIXEL_CHARS        </span>
<a name="l00527"></a>00527 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#gbb237a65fd1053415cb67ba994ae5d6c" title="Set Character Generator RAM Address">LCD_SET_CGRAM_ADDR</a>|number&lt;&lt;4);
<a name="l00528"></a>00528         uint8_t bytes=11;
<a name="l00529"></a>00529 <span class="preprocessor">#else</span>
<a name="l00530"></a>00530 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#gbb237a65fd1053415cb67ba994ae5d6c" title="Set Character Generator RAM Address">LCD_SET_CGRAM_ADDR</a>|number&lt;&lt;3);
<a name="l00531"></a>00531         uint8_t bytes=8;
<a name="l00532"></a>00532 <span class="preprocessor">#endif</span>
<a name="l00533"></a>00533 <span class="preprocessor"></span>        uint8_t i;
<a name="l00534"></a>00534         <span class="keywordflow">for</span> (i=0;i&lt;bytes;i++) {
<a name="l00535"></a>00535                 <a class="code" href="group__lcd__functions.html#gd0729d2cba627825a089ca1fff12ba29" title="Send data and wait 50µs.">lcd_data</a>(pgm_read_byte(data));
<a name="l00536"></a>00536                 data++;
<a name="l00537"></a>00537         }
<a name="l00538"></a>00538 <span class="preprocessor">#if defined LCD_5x10_PIXEL_CHARS        </span>
<a name="l00539"></a>00539 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (i=0;i&lt;5;i++) {
<a name="l00540"></a>00540                 <a class="code" href="group__lcd__functions.html#gd0729d2cba627825a089ca1fff12ba29" title="Send data and wait 50µs.">lcd_data</a>(0);
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542         uint8_t bytes=11;
<a name="l00543"></a>00543 <span class="preprocessor">#endif</span>
<a name="l00544"></a>00544 <span class="preprocessor"></span>        <a class="code" href="group__lcd__functions.html#g577127e048d083cb55aa602cbc5a1cfe" title="Send a raw command and wait for the execution time (3ms for home and clear, 100µs...">lcd_command</a>(<a class="code" href="group__raw__commands.html#ge5fd52eb2dc8c41214d4872644e8f0aa" title="Set Display Data RAM Address (LCD Position) - used by lcd_set_position(), lcd_set_line()...">LCD_SET_DDRAM_ADDR</a>|0);
<a name="l00545"></a>00545         <a class="code" href="group__lcd__functions.html#g3aabf730aa4e0393bb5c959583c00a8e" title="Go to the start position (takes 3ms to execute) This also resets some shift-options...">lcd_home</a>();
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 <span class="comment"></span>
<a name="l00548"></a>00548 <span class="comment">/*@}*/</span>
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Nov 6 17:15:22 2010 for HD44780 Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
